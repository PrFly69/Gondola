// indented with decorate indenter by IvanDobrovski
const int knight_shield_offx = 16;

Actor KnightCrushBoss : BaseMM8BDMWep_CBM {
	Tag "$TAGC_6D"
	Dropitem "KnightCrushWepCDropped"
	Weapon.AmmoUse 0
	Weapon.AmmoGive 28
	Obituary "$OB_KNIGHTCRUSH"
	Weapon.ammotype "KnightmanAmmo"
	States {
		Spawn:
			C_06 D 1
		Loop
		Ready:
			KNIA A 1 ACS_ExecuteAlways(998, 0, DYE_KNIGHTMAN)
			TNT1 A 0 A_GiveInventory("KnightmanShieldSpawner", 1)
		ReadyNext:
			KNIA A 0 A_TakeInventory("StopShield", 9)
		Goto Ready1
		Ready1:
			KNIA A 0 A_JumpIfInventory("KnightmanSuperFlag", 1, "Ready1.a")
			KNIA A 0 A_JumpIfInventory("KnightmanAmmo", 28, "Ready2")
			KNIA A 3 A_WeaponReady(8)
			KNIA A 0 A_GiveInventory("KnightmanAmmo", 1)
		Loop
		Ready2:
			KNIA A 0 A_JumpIfInventory("KnightmanSuperFlag", 1, "Ready2.a")
			KNIA A 3 A_WeaponReady
			KNIA A 0 A_GiveInventory("KnightmanAmmo", 1)
		Loop
		Ready1.a:
			KNIA A 0 A_JumpIfInventory("KnightmanAmmo", 28, "Ready2.a")
			KNIA A 3 A_WeaponReady(8)
			KNIA HH 0 A_SpawnItemEx("BassChargeFX",32,0,random(0,48),velx,vely,velz+12,random(0,360),SXF_TRANSFERTRANSLATION|SXF_ABSOLUTEMOMENTUM)
			KNIA A 0 A_GiveInventory("KnightmanAmmo", 1)
		Ready1.b:
			KNIA A 0 A_JumpIfInventory("KnightmanAmmo", 28, "Ready2.b")
			KNIC G 3 A_WeaponReady(8)
			KNIC HH 0 A_SpawnItemEx("BassChargeFX",32,0,random(0,48),velx,vely,velz+12,random(0,360),SXF_TRANSFERTRANSLATION|SXF_ABSOLUTEMOMENTUM)
			KNIA A 0 A_GiveInventory("KnightmanAmmo", 1)
		Goto Ready1.a
		Ready2.a:
			KNIA A 3 A_WeaponReady
			KNIA HH 0 A_SpawnItemEx("BassChargeFX",32,0,random(0,48),velx,vely,velz+12,random(0,360),SXF_TRANSFERTRANSLATION|SXF_ABSOLUTEMOMENTUM)
			KNIA A 0 A_GiveInventory("KnightmanAmmo", 1)
		Ready2.b:
			KNIC G 3 A_WeaponReady
			KNIC HH 0 A_SpawnItemEx("BassChargeFX",32,0,random(0,48),velx,vely,velz+12,random(0,360),SXF_TRANSFERTRANSLATION|SXF_ABSOLUTEMOMENTUM)
			KNIC A 0 A_GiveInventory("KnightmanAmmo", 1)
		Goto Ready2.a
		Deselect:
			KNIA A 0
			TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
			KNIA A 1 A_Lower
		Loop
		Select:
			TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Raise
			KNIA A 1 A_Raise
		Loop
		Fire:
			KNIA PHF 1
			KNIA A 0 A_JumpIfInventory("KnightmanSuperFlag", 1, "FireSuper")
			KNIA W 0 A_Refire("FireCharge.a")
		Goto FireNormal
		FireCharge.a:
			TNT1 A 0 ACS_ExecuteAlways(512,0,1,-4)
			KNIA B 0 A_PlayWeaponSound("weapon/knightcrushspin")
			KNIC A 0 A_JumpIfInventory("KnightmanCharge", 56, "FireCharged")
			KNIC A 0 A_SpawnItemEx("KnightmanChargeFX",60,0,64,0,0,0,0,1)
			KNIC A 1 A_GiveInventory("KnightmanCharge",1)
			KNIA A 0 A_GiveInventory("KnightmanAmmo", 1)
			KNIC A 0 A_Refire("FireCharge.b")
		Goto FireNormal
		FireCharge.b:
			TNT1 A 0 ACS_ExecuteAlways(512,0,1,-4)
			KNIC A 0 A_JumpIfInventory("KnightmanCharge", 56, "FireCharged")
			KNIC A 0 A_SpawnItemEx("KnightmanChargeFX",60,0,64,0,0,0,40,1)
			KNIC A 1 A_GiveInventory("KnightmanCharge",1)
			KNIC A 0 A_Refire("FireCharge.c")
		Goto FireNormal
		FireCharge.c:
			TNT1 A 0 ACS_ExecuteAlways(512,0,1,-4)
			KNIC A 0 A_JumpIfInventory("KnightmanCharge", 56, "FireCharged")
			KNIC A 0 A_SpawnItemEx("KnightmanChargeFX",60,0,64,0,0,0,80,1)
			KNIC B 1 A_GiveInventory("KnightmanCharge",1)
			KNIC B 0 A_Refire("FireCharge.d")
		Goto FireNormal
		FireCharge.d:
			TNT1 A 0 ACS_ExecuteAlways(512,0,1,-4)
			KNIC A 0 A_JumpIfInventory("KnightmanCharge", 56, "FireCharged")
			KNIC A 0 A_SpawnItemEx("KnightmanChargeFX",60,0,64,0,0,0,120,1)
			KNIC B 1 A_GiveInventory("KnightmanCharge",1)
			KNIC B 0 A_Refire("FireCharge.e")
		Goto FireNormal
		FireCharge.e:
			TNT1 A 0 ACS_ExecuteAlways(512,0,1,-4)
			KNIC A 0 A_JumpIfInventory("KnightmanCharge", 56, "FireCharged")
			KNIC A 0 A_SpawnItemEx("KnightmanChargeFX",60,0,64,0,0,0,160,1)
			KNIC C 1 A_GiveInventory("KnightmanCharge",1)
			KNIC C 0 A_Refire("FireCharge.f")
		Goto FireNormal
		FireCharge.f:
			TNT1 A 0 ACS_ExecuteAlways(512,0,1,-4)
			KNIC A 0 A_JumpIfInventory("KnightmanCharge", 56, "FireCharged")
			KNIC A 0 A_SpawnItemEx("KnightmanChargeFX",60,0,64,0,0,0,200,1)
			KNIC C 1 A_GiveInventory("KnightmanCharge",1)
			KNIA A 0 A_GiveInventory("KnightmanAmmo", 1)
			KNIC C 0 A_Refire("FireCharge.g")
		Goto FireNormal
		FireCharge.g:
			TNT1 A 0 ACS_ExecuteAlways(512,0,1,-4)
			KNIC A 0 A_JumpIfInventory("KnightmanCharge", 56, "FireCharged")
			KNIC A 0 A_SpawnItemEx("KnightmanChargeFX",60,0,64,0,0,0,240,1)
			KNIC D 1 A_GiveInventory("KnightmanCharge",1)
			KNIC D 0 A_Refire("FireCharge.h")
		Goto FireNormal
		FireCharge.h:
			TNT1 A 0 ACS_ExecuteAlways(512,0,1,-4)
			KNIC A 0 A_JumpIfInventory("KnightmanCharge", 56, "FireCharged")
			KNIC A 0 A_SpawnItemEx("KnightmanChargeFX",60,0,64,0,0,0,280,1)
			KNIC D 1 A_GiveInventory("KnightmanCharge",1)
			KNIC D 0 A_Refire("FireCharge.i")
		Goto FireNormal
		FireCharge.i:
			TNT1 A 0 ACS_ExecuteAlways(512,0,1,-4)
			KNIC A 0 A_JumpIfInventory("KnightmanCharge", 56, "FireCharged")
			KNIC A 0 A_SpawnItemEx("KnightmanChargeFX",60,0,64,0,0,0,320,1)
			KNIC E 1 A_GiveInventory("KnightmanCharge",1)
			KNIC E 0 A_Refire("FireCharge.j")
		Goto FireNormal
		FireCharge.j:
			TNT1 A 0 ACS_ExecuteAlways(512,0,1,-4)
			KNIC A 0 A_JumpIfInventory("KnightmanCharge", 56, "FireCharged")
			KNIC A 0 A_SpawnItemEx("KnightmanChargeFX",60,0,64,0,0,0,360,1)
			KNIC E 1 A_GiveInventory("KnightmanCharge",1)
			KNIC E 0 A_Refire("FireCharge.a")
		Goto FireNormal
		FireCharged:
			KNIA B 0 A_GiveInventory("KnightmanSuperFlag",1)
			TNT1 A 0 ACS_ExecuteAlways(512,0,1,0)
			KNIA B 0 A_PlaySoundEx("weapon/adapterreturn","Body")
			KNIA FG 2 ACS_ExecuteAlways(CORE_ACS_191,0,APROP_Speed,1,1)
			KNIC F 0 A_GiveInventory("KnightmanCharge",1)
			KNIC F 2
			KNIA A 2
		FireChargedDone:
			KNIA A 0 ACS_ExecuteAlways(CORE_ACS_191,0,APROP_Speed,1,1)
			KNIA A 3 A_GiveInventory("KnightmanAmmo", 1)
			KNIC G 3 A_GiveInventory("KnightmanAmmo", 1)
			KNIC G 0 A_Refire("FireChargedDone")
		Goto Ready1
		FireNormal:
			KNIA B 0
			TNT1 A 0 ACS_ExecuteAlways(CORE_ACS_191,0,APROP_Speed,1,1)
			KNIA W 1 ACS_ExecuteAlways(512,0,2,0)
			KNIA B 0 A_GiveInventory("StopShield",1)
			KNIA P 0 A_GiveInventory("KnightmanFlag",1)
			KNIA C 0 A_TakeInventory("KnightDouble",1)
			KNIA C 0 A_TakeInventory("KnightmanCharge",999)
			KNIA C 0 A_TakeInventory("KnightmanSuperFlag",999)
			KNIA C 1 A_PlaySoundEx("weapon/KnightShot","Weapon")
			KNIA D 2 A_GiveInventory("KnightmanMain2_CI",1)
			KNIA E 2
			KNIA T 4
		Goto Check
		FireSuper:
			KNIA B 0 
			TNT1 A 0 ACS_ExecuteAlways(CORE_ACS_191,0,APROP_Speed,1,1)
			KNIA W 1 ACS_ExecuteAlways(512,0,2,0)
			KNIA B 0 A_GiveInventory("StopShield",1)
			KNIA P 0 A_GiveInventory("KnightmanFlag",1)
			KNIA C 0 A_TakeInventory("KnightDouble",1)
			KNIA C 0 A_TakeInventory("KnightmanCharge",999)
			KNIA C 0 A_TakeInventory("KnightmanSuperFlag",999)
			KNIA C 1 A_PlaySoundEx("weapon/KnightShot","Weapon")
			KNIA C 0 A_PlaySoundEx("weapon/sunparry","Body")
			KNIA D 2 A_GiveInventory("KnightmanMain_CI",1)
			KNIA E 2
			KNIA T 4
		Goto Check
		Check:
			KNIA D 0 A_JumpIfInventory("KnightDouble",1,"Return")
			KNIA U 1 A_GiveInventory("KnightFlag",1)
			KNIA D 0 A_JumpIfInventory("KnightFlag",35,"Return")
		loop
		Return:
			KNIA H 2 A_TakeInventory("KnightmanFlag",999)
			KNIA P 2
			KNIA A 2 A_TakeInventory("KnightFlag",999)
			KNIA A 2
		Goto ReadyNext
		AltFire:
			KNIA A 1 A_JumpIfInventory("KnightmanAmmo", 28, "ShieldCharge")
		Goto ReadyNext
		ShieldCharge:
			KNIA G 0 A_GiveInventory("VivifyDelay7",1)
			KNIA G 0 A_Refire(1)
			KNIA G 0 A_TakeInventory("KnightmanAmmo",99)
			KNIA G 0 A_PlaySoundEx("weapon/chargekick","Weapon")
			KNIA Q 1 SetPlayerProperty(0,1,0)
			KNIA N 1
			KNIA G 0 A_GiveInventory("StopShield",1)
			KNIA G 0 A_GiveInventory("InvulnerableOn_Pickup",1)
			KNIA O 1 A_ChangeVelocity(Cos(pitch)*6,0,-sin(pitch)*3,1)//A_Recoil(-6)
			KNIA H 0 A_FireCustomMissile("KnightRush")
			KNIA H 0 A_GiveInventory("Repulsion",1)
			KNIA O 1 A_ChangeVelocity(Cos(pitch)*6,0,-sin(pitch)*3,1)
			KNIA H 0 A_FireCustomMissile("KnightRush")
			KNIA H 0 A_GiveInventory("Repulsion",1)
			KNIA O 1 A_ChangeVelocity(Cos(pitch)*6,0,-sin(pitch)*3,1)
			KNIA H 0 A_FireCustomMissile("KnightRush")
			KNIA H 0 A_GiveInventory("Repulsion",1)
			KNIA O 1 A_ChangeVelocity(Cos(pitch)*6,0,-sin(pitch)*3,1)
			KNIA H 0 A_FireCustomMissile("KnightRush")
			KNIA H 0 A_GiveInventory("Repulsion",1)
			KNIA O 1 SetPlayerProperty(0,0,0)
			KNIA G 0 A_GiveInventory("InvulnerableOff_Pickup",1)
			KNIA G 0 A_TakeInventory("StopShield",9)
			KNIA O 1 A_GunFlash
			KNIA NQ 1
		Goto Ready1
	}
}

Actor KnightmanShieldSpawner : CustomInventory {
	+ALWAYSPICKUP
	States {
		Pickup:
			TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox_1")
			TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox_2")
			TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox_3")
			TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox_4")
			TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox_5")
			TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox_6")
			TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox_7")
		Stop
	}
}

Actor KnightmanAmmo : Ammo {
	Inventory.amount 1
	Inventory.maxamount 28
	+INVENTORY.IGNORESKILL
}

Actor KnightmanCharge : Ammo {
	Inventory.amount 1
	Inventory.maxamount 56
	+INVENTORY.IGNORESKILL
}

Actor KnightmanFlag : OnceC { }

Actor KnightmanSuperFlag : OnceC { }

Actor KnightmanCrusher {
	Translation "198:198=75:75","192:192=4:4", "202:202=210:210"
	PROJECTILE
	Damagetype "KnightBonk2"
	Obituary "$OB_KNIGHTCRUSHX"
	+DONTSPLASH
	//+HEXENBOUNCE
	+SKYEXPLODE
	+FORCEXYBILLBOARD
	+THRUGHOST
	BounceFactor 1.0
	WallBounceFactor 1.0
	Damage (0)
	Radius 16
	Height 32
	Speed 50
	Scale 2.5
	States {
			Spawn:
			TNT1 A 0
			TNT1 A 0 ACS_NamedExecuteAlways("BULL_Tidifier", 0)
			SpawnLOOP:
			KNIA I 0
			KCRB DD 1 A_SpawnItemEx("KnightmanCrusherStronkWire",0,0,0,0,0,0,0,1)
			KNIA I 0 A_ChangeFlag("THRUGHOST", 0)
			SpawnPOOP:
			KCRB DDDDDDDDDD 1 A_SpawnItemEx("KnightmanCrusherStronkWire",0,0,0,0,0,0,0,1)
			KNIA I 0 A_SpawnItemEx("KnightmanCrusherReturn", 0, 0, 0, 0, 0, 0, 0, 1)
			stop
		Crash:
		XDeath:
		Death:
			//KNIA I 0 A_GiveToTarget("KnightDouble", 1)
			TNT1 A 0 A_Explode(25,64,0,0,64)
			TNT1 A 0 A_PlaySoundEx("misc/hugequake","Body")
			TNT1 A 0 //A_Quake(3,28,0,512)
			KNIA I 0 A_TakeFromTarget("KnightFlag", 999)
			KNIA I 0 A_SpawnItemEx("KnightmanCrusherReturn", 0, 0, 0, 0, 0, 0, 0, 1)
			TN_B EFGHIJKLMNOPQRS 2
		Stop
	}
}

Actor KnightmanCrusherB : KnightmanCrusher {
	Translation "198:198=74:74","192:192=4:4", "202:202=205:205"
}

Actor KnightmanCrusherR : KnightmanCrusher {
	Translation "198:198=41:41","192:192=4:4", "202:202=171:171"
}

Actor KnightmanCrusherO : KnightmanCrusher {
	Translation "198:198=128:128","192:192=4:4", "202:202=104:104"
}

Actor KnightmanCrusherP : KnightmanCrusher {
	Translation "198:198=232:232","192:192=4:4", "202:202=229:229"
}

Actor KnightmanCrusherStronkWire : DuoPunchWire {
	Translation "192:192=85:85"
	+NOINTERACTION
	+SEEKERMISSILE
	ReactionTime 18
	damage (0)
	Speed 50
	scale 1
	States {
		Spawn:
			TNT1 A 0
			TNT1 A 0 A_RearrangePointers(0,0,2)
			TNT1 A 0 A_FaceTarget
			goto Spawn2
		Spawn2:
			TNT1 A 0 A_JumpIfCloser(46,"Death")
			TNT1 AA 0 A_SeekerMissile(90,90,SMF_PRECISE)
			TNT1 A 1 A_SpawnItemEx("KnightmanCrusherStronkWireFX",0,0,0,0,0,0,0,1)
			TNT1 A 0 A_CountDown
			TNT1 A 0 A_JumpIf(ACS_ExecuteWithResult(C_CHECK_TARGET_OOC)==0,"Death")
		loop
		Return:
		Death2:
		Death:
			TNT1 A 0 
		stop
	}
}

Actor KnightmanCrusherStronkWireFX : DuoPunchWireFX {
	+NOINTERACTION
	+FORCEXYBILLBOARD
	renderstyle translucent
	alpha 0.3
	scale 1.0
	States {
		Spawn:
			TNT1 A 1
			TNT1 A 0 A_JumpIfCloser(46, "Death")
			KCRB C 2 
		stop
		Death:
			TNT1 A 0
		stop
	}
}

Actor KnightReturnerSound : BasicHelper {
	States {
		Spawn:
			TNT1 A 0
			TNT1 A 1 A_PlaySoundEx("weapon/KnightReturn", "Weapon")
		Stop
	}
}

Actor KnightmanCrusherReturn : KnightmanCrusher {
	+NOINTERACTION
	+SEEKERMISSILE
	ReactionTime 87//about 10 seconds
	Renderstyle Translucent
	Alpha 0.5
	States {
		Spawn:
			KNIA I 0
			KNIA I 0 A_RearrangePointers(AAPTR_DEFAULT, AAPTR_DEFAULT, AAPTR_TARGET)//Target >> Tracer
			KNIA I 0 A_FaceTarget
		Goto Spawn2
		Spawn2:
			KNIA I 0 A_TakeFromTarget("KnightFlag", 99)
			KNIA I 0 A_JumpIfCloser(46, "Death")
			KNIA I 0 A_SpawnItemEx("KnightReturnerSound")
			KNIA II 0 A_SeekerMissile(90, 90, SMF_PRECISE)
			KCRB D 1
			KNIA I 0 A_JumpIfCloser(46, "Death")
			KCRB D 1
			KNIA I 0 A_JumpIfCloser(46, "Death")
			KCRB D 1
			KNIA I 0 A_JumpIfCloser(46, "Death")
			KCRB D 1
			KNIA I 0 A_JumpIfCloser(46, "Death")
			KNIA I 0 A_CountDown
			KNIA I 0 A_JumpIf(ACS_ExecuteWithResult(C_CHECK_TARGET_OOC)==0, "Death")
		Loop
		Death:
			KNIA I 0 A_GiveToTarget("KnightDouble", 1)
			KNIA I 0 A_TakeFromTarget("KnightFlag", 999)
		stop
	}
}

Actor KnightmanCrusherDamager {
	PROJECTILE
	Damagetype "ClassPainLess2"
	Obituary "$OB_KNIGHTCRUSHX"
	+RIPPER
	+DONTBLAST
	Damage (9)//11
	Radius 12
	Height 12
	States {
		Spawn:
			TNT1 A 2
		Stop
	}
}

Actor KnightmanCrusherNoRip : KnightmanCrusher {
	Translation "198:198=75:75", "205:205=95:95"
	Damagetype "KnightCrushNoisy"
	Obituary "$OB_KNIGHTCRUSH"
	BounceFactor 1.0
	WallBounceFactor 1.0
	Damage (15)
	Radius 8
	Height 16
	reactiontime 10
	States {
		Spawn:
			TNT1 A 0
			TNT1 A 0 ACS_NamedExecuteAlways("BULL_Tidifier", 0)
			SpawnLOOP:
			KNIA I 0
			TNT1 A 0 ACS_NamedExecuteWithResult("CCBM_PitchAngleSetter",1)
			TNT1 A 0 A_ChangeVelocity(cos(-pitch)*50,0,sin(-pitch)*50,3)
			KNIA I 1 A_SpawnItemEx("KnightmanCrusherNoRipWire",0,0,0,0,0,0,0,1)
			TNT1 A 0 ACS_NamedExecuteWithResult("CCBM_PitchAngleSetter",1)
			TNT1 A 0 A_ChangeVelocity(cos(-pitch)*50,0,sin(-pitch)*50,3)
			KNIA I 1 A_SpawnItemEx("KnightmanCrusherNoRipWire",0,0,0,0,0,0,0,1)
			TNT1 A 0 ACS_NamedExecuteWithResult("CCBM_PitchAngleSetter",1)
			TNT1 A 0 A_ChangeVelocity(cos(-pitch)*50,0,sin(-pitch)*50,3)
			KNIA I 0 A_ChangeFlag("THRUGHOST", 0)
			SpawnPOOP:
			KNIA I 1 //A_SpawnItemEx("KnightmanCrusherNoRipWire",0,0,0,0,0,0,0,1)
			TNT1 A 0 ACS_NamedExecuteWithResult("CCBM_PitchAngleSetter",1)
			TNT1 A 0 A_ChangeVelocity(cos(-pitch)*50,0,sin(-pitch)*50,3)
			KNIA I 0 A_SpawnItemEx("KnightmanCrusherNoRipWire",0,0,0,0,0,0,0,1)
			KNIA I 0 A_CountDown
			goto SpawnPOOP
			//KNIA I 0 A_TakeFromTarget("KnightFlag", 999)
			//KNIA II 1 A_SpawnItemEx("KnightmanCrusherNoRipWire",0,0,0,0,0,0,0,1)
			//KNIA I 0 A_SpawnItemEx("KnightmanCrusherNoRipReturn", 0, 0, 0, 0, 0, 0, 0, 1)
		Death:
			//KNIA I 0 A_GiveToTarget("KnightDouble", 1)
			KNIA I 0 A_TakeFromTarget("KnightFlag", 999)
			KNIA I 0 A_SpawnItemEx("KnightmanCrusherNoRipReturn", 0, 0, 0, 0, 0, 0, 0, 1)
		Stop
		XDeath:
		Crash:
			KNIA I 0 A_ChangeFlag("THRUGHOST", 0)
			KNIA I 0 A_TakeFromTarget("KnightFlag", 999)
			KNIA I 1 A_SpawnItemEx("KnightmanCrusherNoRipReturn", 0, 0, 0, 0, 0, 0, 0, 1)
		Stop
	}
}

Actor KnightmanCrusherNoRipB : KnightmanCrusherNoRip {
	Translation "198:198=74:74", "205:205=95:95"
}

Actor KnightmanCrusherNoRipR : KnightmanCrusherNoRip {
	Translation "198:198=41:41", "205:205=95:95"
}

Actor KnightmanCrusherNoRipO : KnightmanCrusherNoRip {
	Translation "198:198=128:128", "205:205=95:95"
}

Actor KnightmanCrusherNoRipP : KnightmanCrusherNoRip {
	Translation "198:198=232:232", "205:205=95:95"
}

Actor KnightmanCrusherNoRipReturn : KnightmanCrusherNoRip {
	+NOINTERACTION
	+SEEKERMISSILE
	ReactionTime 87//about 10 seconds
	Renderstyle Translucent
	Alpha 0.5
	States {
		Spawn:
			KNIA I 0
			KNIA I 0 A_RearrangePointers(AAPTR_DEFAULT, AAPTR_DEFAULT, AAPTR_TARGET)//Target >> Tracer
			KNIA I 0 A_FaceTarget
		Goto Spawn2
		Spawn2:
			KNIA I 0 A_TakeFromTarget("KnightFlag", 99)
			KNIA I 0 A_JumpIfCloser(46, "Death")
			KNIA I 0 A_SpawnItemEx("KnightReturnerSound")
			KNIA II 0 A_SeekerMissile(90, 90, SMF_PRECISE)
			KNIA I 1
			KNIA I 0 A_JumpIfCloser(46, "Death")
			KNIA I 1
			KNIA I 0 A_JumpIfCloser(46, "Death")
			KNIA I 1
			KNIA I 0 A_JumpIfCloser(46, "Death")
			KNIA I 1
			KNIA I 0 A_JumpIfCloser(46, "Death")
			KNIA I 0 A_CountDown
			KNIA I 0 A_JumpIf(ACS_ExecuteWithResult(C_CHECK_TARGET_OOC)==0, "Death")
		Loop
		Death:
			KNIA I 0 A_GiveToTarget("KnightDouble", 1)
			KNIA I 0 A_TakeFromTarget("KnightFlag", 999)
		stop
	}
}

Actor KnightmanCrusherNoRipWire : DuoPunchWire {
	Translation "205:205=95:95"
	+NOINTERACTION
	+SEEKERMISSILE
	ReactionTime 18
	damage (0)
	Speed 50
	States {
		Spawn:
			TNT1 A 0
			TNT1 A 0 A_RearrangePointers(0,0,2)
			TNT1 A 0 A_FaceTarget
			goto Spawn2
		Spawn2:
			TNT1 A 0 A_JumpIfCloser(46,"Death")
			TNT1 AA 0 A_SeekerMissile(90,90,SMF_PRECISE)
			TNT1 A 1 A_SpawnItemEx("KnightmanCrusherNoRipWireFX",0,0,0,0,0,0,0,1)
			TNT1 A 0 A_CountDown
			TNT1 A 0 A_JumpIf(ACS_ExecuteWithResult(C_CHECK_TARGET_OOC)==0,"Death")
		loop
		Return:
		Death2:
		Death:
			TNT1 A 0 
		stop
	}
}

Actor KnightmanCrusherNoRipWireFX : DuoPunchWireFX {
	+NOINTERACTION
	Scale 1.5
	Renderstyle Translucent
	Alpha 0.65
	States {
		Spawn:
			TNT1 A 1
			TNT1 A 0 A_JumpIfCloser(46, "Death")
			KNIA Y 2 
		stop
		Death:
			TNT1 A 0
		stop
	}
}

actor KnightmanChargeFX {
	PROJECTILE
	Radius 8
	Height 8
	scale 2.5
	damage (0)
	+NOCLIP
	+RIPPER
	+DONTSPLASH
	//+NOTARGETSWITCH
	+SKYEXPLODE
	speed 0
	States {
	Spawn:
		KNIA I 0
		KNIA I 1 A_SpawnItemEx("KnightmanChargeFXDamager", 0, 0, -32, momx, momy, momz, 0, 8)
	Death:
		KNIA I 0
		stop
	}
}

Actor KnightmanChargeFXDamager {
	PROJECTILE
	damagetype "KnightBonk"
	obituary "$OB_KNIGHTCRUSHY"
	+RIPPER
	+DONTBLAST
	+THRUGHOST
	Damage (4)
	Radius 12
	Height 12
	States {
		Spawn:
			TNT1 A 2
		Stop
	}
}

actor KnightBonkProtect : PowerProtection
{
Powerup.Duration 5
DamageFactor "KnightBonk", 0.0
}

Actor KnightShieldX : BasicHelper {
    +NOTIMEFREEZE
    States {
        Spawn:
            TNT1 A 0
            TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox", 0, -24, 0, velx, vely, velz, 0, 8)
            TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox", 0, -16, 0, velx, vely, velz, 0, 8)
            TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox", 0, -8, 0, velx, vely, velz, 0, 8)
            TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox", 0, 0, 0, velx, vely, velz, 0, 8)
            TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox", 0, 8, 0, velx, vely, velz, 0, 8)
            TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox", -8, 8, 0, velx, vely, velz, 0, 8)
            TNT1 A 0 A_SpawnItemEx("KnightShieldHitbox", -16, 8, 0, velx, vely, velz, 0, 8)
            TNT1 A 5
        Stop
    }
}

Actor NewProtoShieldHitbox {
	+MISSILE
	Speed 0
	+DONTSPLASH
	Damage 0
	Height 42
	Radius 5
	Health 9999
	Scale 2.5
	Damagefactor "ProtoBuster", 1.0
	+SHOOTABLE
	+NOBLOOD
	-SOLID
	+NOTIMEFREEZE
	+NOTARGETSWITCH
	+NOGRAVITY
	+HEXENBOUNCE
	+BOUNCEONACTORS
	Painchance 256
	Bloodtype ""
	+DONTRIP
	+GHOST
	+NORADIUSDMG
	+DONTBLAST
	+DONTDRAIN
	States {
		Spawn:
			TNT1 A 0
			TNT1 A 2
		Stop
		Death:
			TNT1 A 0
			TNT1 A 1
		Stop
		Pain:
			TNT1 A 0
			TNT1 A 0 A_SpawnItemEx("ProtoShieldDeahthFX")
			TNT1 A 1 A_PlaySound("item/protoreflect")
		Stop
	}
}

Actor KnightShieldHitbox : NewProtoShieldHitbox {
	+NOCLIP
	States {
		Pain:
			TNT1 A 0
			TNT1 A 0 A_SpawnItemEx("KnightShieldDeathFX")
			TNT1 A 2 A_PlaySound("item/protoreflect")
		Goto Spawn
	}
}

Actor KnightShieldHitbox_1 : KnightShieldHitbox {
    States {
        Spawn:
            TNT1 A 0
            TNT1 AA 1 A_Warp(AAPTR_TARGET, knight_shield_offx, 0, 0, 0, WARPF_NOCHECKPOSITION)
            TNT1 A 0 A_JumpIfInTargetInventory("StopShield", 1, "UnsetShootable")
            TNT1 A 0 A_JumpIf(!ACS_NamedExecuteWithResult("CCBM Knight Shield Check"), "Death")
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 1)
        Loop
        UnsetShootable:
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0)
        Goto Spawn
        Pain:
            TNT1 A 0
            TNT1 A 0 A_SpawnItemEx("KnightShieldDeathFX")
            TNT1 A 1 A_PlaySound("item/protoreflect")
        Goto Spawn
    }
}
 
Actor KnightShieldHitbox_2 : NewProtoShieldHitbox {
    States {
        Spawn:
            TNT1 A 0
            TNT1 AA 1 A_Warp(AAPTR_TARGET, knight_shield_offx, 9, 0, 0, WARPF_NOCHECKPOSITION)
            TNT1 A 0 A_JumpIfInTargetInventory("StopShield", 1, "UnsetShootable")
            TNT1 A 0 A_JumpIf(!ACS_NamedExecuteWithResult("CCBM Knight Shield Check"), "Death")
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 1)
        Loop
        UnsetShootable:
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0)
        Goto Spawn
        Pain:
            TNT1 A 0
            TNT1 A 0 A_SpawnItemEx("KnightShieldDeathFX")
            TNT1 A 1 A_PlaySound("item/protoreflect")
        Goto Spawn
    }
}
 
Actor KnightShieldHitbox_3 : NewProtoShieldHitbox {
    States {
        Spawn:
            TNT1 A 0
            TNT1 AA 1 A_Warp(AAPTR_TARGET, knight_shield_offx, 18, 0, 0, WARPF_NOCHECKPOSITION)
            TNT1 A 0 A_JumpIfInTargetInventory("StopShield", 1, "UnsetShootable")
            TNT1 A 0 A_JumpIf(!ACS_NamedExecuteWithResult("CCBM Knight Shield Check"), "Death")
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 1)
        Loop
        UnsetShootable:
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0)
        Goto Spawn
        Pain:
            TNT1 A 0
            TNT1 A 0 A_SpawnItemEx("KnightShieldDeathFX")
            TNT1 A 1 A_PlaySound("item/protoreflect")
        Goto Spawn
    }
}
 
Actor KnightShieldHitbox_4 : NewProtoShieldHitbox {
    States {
        Spawn:
            TNT1 A 0
            TNT1 AA 1 A_Warp(AAPTR_TARGET, knight_shield_offx, 27, 0, 0, WARPF_NOCHECKPOSITION)
            TNT1 A 0 A_JumpIfInTargetInventory("StopShield", 1, "UnsetShootable")
            TNT1 A 0 A_JumpIf(!ACS_NamedExecuteWithResult("CCBM Knight Shield Check"), "Death")
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 1)
        Loop
        UnsetShootable:
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0)
        Goto Spawn
        Pain:
            TNT1 A 0
            TNT1 A 0 A_SpawnItemEx("KnightShieldDeathFX")
            TNT1 A 1 A_PlaySound("item/protoreflect")
        Goto Spawn
    }
}
 
Actor KnightShieldHitbox_5 : NewProtoShieldHitbox {
    States {
        Spawn:
            TNT1 A 0
            TNT1 AA 1 A_Warp(AAPTR_TARGET, knight_shield_offx, 36, 0, 0, WARPF_NOCHECKPOSITION)
            TNT1 A 0 A_JumpIfInTargetInventory("StopShield", 1, "UnsetShootable")
            TNT1 A 0 A_JumpIf(!ACS_NamedExecuteWithResult("CCBM Knight Shield Check"), "Death")
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 1)
        Loop
        UnsetShootable:
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0)
        Goto Spawn
        Pain:
            TNT1 A 0
            TNT1 A 0 A_SpawnItemEx("KnightShieldDeathFX")
            TNT1 A 1 A_PlaySound("item/protoreflect")
        Goto Spawn
    }
}
 
Actor KnightShieldHitbox_6 : NewProtoShieldHitbox {
    States {
        Spawn:
            TNT1 A 0
            TNT1 AA 1 A_Warp(AAPTR_TARGET, knight_shield_offx - 8, 36, 0, 0, WARPF_NOCHECKPOSITION)
            TNT1 A 0 A_JumpIfInTargetInventory("StopShield", 1, "UnsetShootable")
            TNT1 A 0 A_JumpIf(!ACS_NamedExecuteWithResult("CCBM Knight Shield Check"), "Death")
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 1)
        Loop
        UnsetShootable:
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0)
        Goto Spawn
        Pain:
            TNT1 A 0
            TNT1 A 0 A_SpawnItemEx("KnightShieldDeathFX")
            TNT1 A 1 A_PlaySound("item/protoreflect")
        Goto Spawn
    }
}
 
Actor KnightShieldHitbox_7 : NewProtoShieldHitbox {
    States {
        Spawn:
            TNT1 A 0
            TNT1 AA 1 A_Warp(AAPTR_TARGET, knight_shield_offx - 16, 36, 0, 0, WARPF_NOCHECKPOSITION)
            TNT1 A 0 A_JumpIfInTargetInventory("StopShield", 1, "UnsetShootable")
            TNT1 A 0 A_JumpIf(!ACS_NamedExecuteWithResult("CCBM Knight Shield Check"), "Death")
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 1)
        Loop
        UnsetShootable:
            TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0)
        Goto Spawn
        Pain:
            TNT1 A 0
            TNT1 A 0 A_SpawnItemEx("KnightShieldDeathFX")
            TNT1 A 1 A_PlaySound("item/protoreflect")
        Goto Spawn
    }
}

Actor KnightShieldDeathFX : BasicClientSide {
	Alpha 0.9
	Renderstyle add
	States {
		Spawn:
			KNIA L 0 A_SetScale(scaleX + 0.1, 2.5)
			KNIA L 1 A_FadeOut(0.05)
		Loop
	}
}

Actor KnightRush : BasicExplosion {
	Damagetype "KnightRush"
	Obituary "$OB_KNIGHTRUSH"
	States {
		Spawn:
			TNT1 A 0
			TNT1 A 1 A_Explode(5, 120, 0, 0, 16)
		Stop
	}
}

Actor KnightmanMain_CI : TeamColor_CI {
	States {
		FireX:
			TNT1 A 0 A_FireCustomMissile("KnightmanCrusher", 0, -8, 0, 0)
		Goto Done
		FireB:
			TNT1 A 0 A_FireCustomMissile("KnightmanCrusherB", 0, -8, 0, 0)
		Goto Done
		FireR:
			TNT1 A 0 A_FireCustomMissile("KnightmanCrusherR", 0, -8, 0, 0)
		Goto Done
		FireO:
			TNT1 A 0 A_FireCustomMissile("KnightmanCrusherO", 0, -8, 0, 0)
		Goto Done
		FireP:
			TNT1 A 0 A_FireCustomMissile("KnightmanCrusherP", 0, -8, 0, 0)
		Goto Done
	}
}

Actor KnightmanMain2_CI : TeamColor_CI {
	States {
		FireX:
			TNT1 A 0 A_FireCustomMissile("KnightmanCrusherNoRip", 0, -8, 0, 0)
		Goto Done
		FireB:
			TNT1 A 0 A_FireCustomMissile("KnightmanCrusherNoRipB", 0, -8, 0, 0)
		Goto Done
		FireR:
			TNT1 A 0 A_FireCustomMissile("KnightmanCrusherNoRipR", 0, -8, 0, 0)
		Goto Done
		FireO:
			TNT1 A 0 A_FireCustomMissile("KnightmanCrusherNoRipO", 0, -8, 0, 0)
		Goto Done
		FireP:
			TNT1 A 0 A_FireCustomMissile("KnightmanCrusherNoRipP", 0, -8, 0, 0)
		Goto Done
	}
}